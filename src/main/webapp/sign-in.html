<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>学籍信息跟踪管理系统-登陆</title>
    <meta name="description" content="这是一个 index 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="icon" type="image/png" href="assets/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="Amaze UI"/>
    <link rel="stylesheet" href="assets/css/amazeui.min.css"/>
    <link rel="stylesheet" href="assets/css/amazeui.datatables.min.css"/>
    <link rel="stylesheet" href="assets/css/app.css">
    <script src="assets/js/jquery.min.js"></script>

</head>

<body data-type="login">
<script src="assets/js/theme.js"></script>
<div class="am-g tpl-g">
    <div class="tpl-login">
        <div class="tpl-login-content">
            <a style="font-size: larger">
                <center>
                    学籍信息跟踪管理系统
                </center>
            </a>

            <form class="am-form tpl-form-line-form" onsubmit="return f();">
                <div class="am-form-group">
                    <input type="text" class="tpl-form-input" name="username" placeholder="请输入账号" id="getname"
                           required>

                </div>

                <div class="am-form-group">
                    <input type="password" class="tpl-form-input" name="userpwd" id="getpwd" placeholder="请输入密码"
                           required>

                </div>
                <div class="am-form-group tpl-login-remember-me" style="text-align: right">
                    <label>
                        <a href="find.html">忘记密码？点击找回(仅支持学生用户)</a>
                    </label>
                </div>


                <div class="am-form-group">

                    <input type="submit"
                           class="am-btn am-btn-primary  am-btn-block tpl-btn-bg-color-success  tpl-login-btn"
                           value="登陆">
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function f() {
        id = document.getElementById("getname").value;
        pwd = document.getElementById("getpwd").value;
        allData = {
            "id": id,
            "pwd": pwd
        };
        $.ajax({
            url: 'login',
            type: 'post',
            // 设置的是请求参数
            data: JSON.stringify(allData),
            // 用于设置响应体的类型 注意 跟 data 参数没关系！！！
            contentType: 'application/json;charset=utf-8',
            success: function (res) {
                // 一旦设置的 dataType 选项，就不再关心 服务端 响应的 Content-Type 了
                // 客户端会主观认为服务端返回的就是 JSON 格式的字符串
                console.log(res)
                if (res.status === "success") {
                    var storage = window.localStorage;
                    storage.setItem("id", res.userId);
                    storage.setItem("role", res.role);
                    storage.setItem("name", res.userName);
                    window.location.href = "index.html";
                } else {
                    alert(res.info);
                    document.getElementById("getpwd").value = "";
                }
            }
        })
        return false;
    }
</script>
<script src="assets/js/amazeui.min.js"></script>
<script src="assets/js/app.js"></script>

</body>

</html>